<?xml version="1.0" encoding="utf-8"?>
<!--
  For more information on how to configure your ASP.NET application, please visit
   https://go.microsoft.com/fwlink/?LinkId=169433
  -->
<configuration>
  
  <!-- 
    SECURITY WARNING: 
    Sensitive information in this file (passwords, connection strings) are EXAMPLES only.
    In production environment:
    1. Use environment variables (e.g.: OPENTICKET_CONNECTION_STRING)
    2. Use secret management services like Azure Key Vault, AWS Secrets Manager
    3. DO NOT commit Web.config to git (if it contains real values)
  -->
  
  <connectionStrings>
    <!-- 
      SQL Server connection string
      In production, move this value to environment variable: OPENTICKET_CONNECTION_STRING
      Example environment variable:
      OPENTICKET_CONNECTION_STRING=Data Source=YOUR_SERVER;Initial Catalog=ticket;User ID=YOUR_USER;Password=YOUR_PASSWORD;
    -->
    <add name="OpenTicketDb" 
         connectionString="Data Source=localhost\SQLEXPRESS;Initial Catalog=ticket;Integrated Security=True;" 
         providerName="System.Data.SqlClient" />
  </connectionStrings>

  <appSettings>
    <!-- SMTP Settings -->
    <!-- In production, use environment variables: OPENTICKET_SMTPHOST, OPENTICKET_SMTPUSERNAME, etc. -->
    <add key="SmtpHost" value="smtp.gmail.com" />
    <add key="SmtpPort" value="587" />
    <add key="SmtpUsername" value="your-email@gmail.com" />
    <add key="SmtpPassword" value="YOUR_APP_PASSWORD_HERE" />
    <add key="SmtpSenderEmail" value="your-email@gmail.com" />
    <add key="SmtpSenderName" value="OpenTicket" />
    <add key="SmtpEnableSsl" value="true" />

    <!-- Security Settings -->
    <add key="ValidationSettings:UnobtrusiveValidationMode" value="None" />
  </appSettings>

  <system.web>
    <compilation debug="true" targetFramework="4.7.2" />
    <httpRuntime targetFramework="4.7.2" 
                 maxRequestLength="10240" 
                 executionTimeout="3600" 
                 enableVersionHeader="false" />
    
    <!-- Session security -->
    <sessionState mode="InProc" 
                  timeout="20" 
                  cookieName="OpenTicketSession" 
                  cookieSameSite="Strict" />

    <!-- Custom errors (set to On in production) -->
    <customErrors mode="RemoteOnly" defaultRedirect="~/Error.aspx">
      <error statusCode="404" redirect="~/Error404.aspx" />
      <error statusCode="500" redirect="~/Error500.aspx" />
    </customErrors>

    <!-- HTTP Security Headers -->
    <httpCookies httpOnlyCookies="true" requireSSL="true" sameSite="Strict" />
    
    <!-- Trace (disable in production) -->
    <trace enabled="false" localOnly="true" pageOutput="false" />
    
    <!-- ViewState MAC validation -->
    <pages enableViewStateMac="true" validateRequest="true" viewStateEncryptionMode="Always">
    </pages>
  </system.web>

  <system.webServer>
    <!-- Security Headers -->
    <httpProtocol>
      <customHeaders>
        <!-- XSS protection -->
        <add name="X-XSS-Protection" value="1; mode=block" />
        <!-- Clickjacking protection -->
        <add name="X-Frame-Options" value="SAMEORIGIN" />
        <!-- MIME type sniffing protection -->
        <add name="X-Content-Type-Options" value="nosniff" />
        <!-- Referrer policy -->
        <add name="Referrer-Policy" value="strict-origin-when-cross-origin" />
        <!-- Content Security Policy (customize as needed) -->
        <add name="Content-Security-Policy" value="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; img-src 'self' data:;" />
        <!-- Strict Transport Security (HTTPS required) -->
        <add name="Strict-Transport-Security" value="max-age=31536000; includeSubDomains" />
        <!-- Permissions Policy -->
        <add name="Permissions-Policy" value="geolocation=(), microphone=(), camera=()" />
      </customHeaders>
    </httpProtocol>

    <!-- HTTP -> HTTPS redirect with URL Rewrite (requires URL Rewrite module in IIS) -->
    <!--
    <rewrite>
      <rules>
        <rule name="HTTPS Redirect" stopProcessing="true">
          <match url="(.*)" />
          <conditions>
            <add input="{HTTPS}" pattern="^OFF$" />
          </conditions>
          <action type="Redirect" url="https://{HTTP_HOST}/{R:1}" redirectType="Permanent" />
        </rule>
      </rules>
    </rewrite>
    -->

    <!-- Error pages -->
    <httpErrors errorMode="DetailedLocalOnly">
      <remove statusCode="404" />
      <error statusCode="404" path="/Error404.aspx" responseMode="ExecuteURL" />
      <remove statusCode="500" />
      <error statusCode="500" path="/Error500.aspx" responseMode="ExecuteURL" />
    </httpErrors>

    <!-- Static content caching -->
    <staticContent>
      <clientCache cacheControlMode="UseMaxAge" cacheControlMaxAge="7.00:00:00" />
    </staticContent>

    <!-- Remove unnecessary HTTP headers -->
    <security>
      <requestFiltering removeServerHeader="true">
        <!-- Maximum upload size (10 MB) -->
        <requestLimits maxAllowedContentLength="10485760" />
      </requestFiltering>
    </security>
  </system.webServer>

  <system.codedom>
    <compilers>
      <compiler language="c#;cs;csharp" extension=".cs" type="Microsoft.CodeDom.Providers.DotNetCompilerPlatform.CSharpCodeProvider, Microsoft.CodeDom.Providers.DotNetCompilerPlatform, Version=2.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" warningLevel="4" compilerOptions="/langversion:default /nowarn:1659;1699;1701" />
      <compiler language="vb;vbs;visualbasic;vbscript" extension=".vb" type="Microsoft.CodeDom.Providers.DotNetCompilerPlatform.VBCodeProvider, Microsoft.CodeDom.Providers.DotNetCompilerPlatform, Version=2.0.1.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35" warningLevel="4" compilerOptions="/langversion:default /nowarn:41008 /define:_MYTYPE=\&quot;Web\&quot; /optionInfer+" />
    </compilers>
  </system.codedom>

  <runtime>
    <assemblyBinding xmlns="urn:schemas-microsoft-com:asm.v1">
      <!-- Assembly bindings buraya eklenebilir -->
    </assemblyBinding>
  </runtime>
</configuration>
